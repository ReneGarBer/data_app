version: 2

models:
  - name: fac_casos_dengue
    description: Tabla de hechos de casos de dengue en jalisco
    +post_hook: "ALTER TABLE {{ this }} ADD PRIMARY KEY (id_caso)"
    tags: metricas
    columns:
      - name: id_fecha_carga
        data_tests:
          - relationships:
              to: ref('dim_fecha')
              field: id_fecha

      - name: id_fecha_inicial
        data_tests:
          - valid_id_fecha_inicial_month    
          - relationships:
              to: ref('dim_fecha')
              field: id_fecha

      - name: id_fecha_final
        data_tests:
          - relationships:
              to: ref('dim_fecha')
              field: id_fecha
      
      - name: id_fuente
        data_tests:
          - relationships:
              to: ref('dim_fuente')
              field: id

      - name: id_region
        data_tests:
          - relationships:
              to: ref('dim_region')
              field: id_region

  - name: fac_medicion_climatica
    +post_hook: "ALTER TABLE {{ this }} ADD PRIMARY KEY (id_medicion)"
    tags: metricas
    columns:
      - name: id_medicion
        data_tests:
          - unique
          - not_null

      - name: id_fecha_carga
        data_tests:
          - relationships:
              to: ref('dim_fecha')
              field: id_fecha

      - name: id_fecha_inicial
        data_tests:            
          - relationships:
              to: ref('dim_fecha')
              field: id_fecha
          

      - name: id_fecha_final
        data_tests:
          - relationships:
              to: ref('dim_fecha')
              field: id_fecha

      - name: id_region
        data_tests:
          - relationships:
              to: ref('dim_region')
              field: id_region

      - name: id_tipo
        data_tests:
          - relationships:
              to: ref('dim_tipo')
              field: codigo

  - name: fac_medicion_climatica_promedios_mensuales
    config:
      tags: aggregated
    columns:
      - name: promedio_mensual 
        data_tests:
          - not_null

  - name: fac_medicion_climatica_promedios_semanales
    config:
      tags: aggregated
    columns:
      - name: promedio_semanal 
        data_tests:
          - not_null